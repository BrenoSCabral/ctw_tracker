<!-- Rodar python -m http.server 8000 pra ver localmente -->

<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CTW Tracker</title>
  <link rel="apple-touch-icon" sizes="180x180" href="favicon_io/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="favicon_io/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="favicon_io/favicon-16x16.png">
  <link rel="manifest" href="favicon_io/site.webmanifest">


  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    html, body {
      height: 100%;
      margin: 0;
      font-family: system-ui, sans-serif;
      background: #f8f9fa;
      overflow: hidden;
    }

    #map {
      width: 100%;
      height: 100%;
      transition: width 0.2s ease;
    }

    /* Painel lateral */
    #chart-panel {
      position: absolute;
      top: 0;
      right: 0;
      width: 0;
      height: 100%;
      background: #fff;
      box-shadow: -4px 0 20px rgba(0, 0, 0, 0.15);
      display: flex;
      flex-direction: column;
      z-index: 1000;
      overflow: hidden;
      transition: width 0.2s ease;
    }

    #chart-panel.open {
      width: 60%;
    }

    #chart-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 16px;
      border-bottom: 1px solid #ddd;
      background: #f5f5f5;
    }

    #chart-header h2 {
      font-size: 1rem;
      margin: 0;
    }

    #close-btn {
      cursor: pointer;
      font-size: 20px;
      color: #333;
      border: none;
      background: none;
    }

    #chart-frame {
      flex: 1;
      width: 100%;
      border: none;
    }
  </style>
</head>
<body>


  <div id="map"></div>

  <div id="chart-panel">
    <div id="chart-header">
      <h2 id="station-name">Estação</h2>
      <button id="close-btn" title="Fechar">×</button>
    </div>
    <iframe id="chart-frame"></iframe>
  </div>



  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <script>
    // Mapa inicial
    const map = L.map('map', {
      zoomControl: false,
      attributionControl: false
    }).setView([-20, -44], 4);

    // Camada base clean
    L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
      maxZoom: 12
    }).addTo(map);

    const pinIcon = L.icon({
      iconUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png',
      iconSize: [25, 40],
      iconAnchor: [12, 40],
      popupAnchor: [0, -30]
    });

    const chartPanel = document.getElementById('chart-panel');
    const chartFrame = document.getElementById('chart-frame');
    const stationName = document.getElementById('station-name');
    const closeBtn = document.getElementById('close-btn');

    let activeStation = null;

  function openChart(station) {
    activeStation = station;

    // Abre o painel lateral
    chartPanel.classList.add('open');
    chartFrame.src = station.file;
    stationName.textContent = station.name;

    // Espera animação/resize e então reajusta o mapa
    setTimeout(() => {

        // Escolha do zoom desejado quando o painel abre:
        // - usar um zoom fixo (6) ou manter o zoom atual: map.getZoom()
        const targetZoom = 8; // ajuste aqui se preferir outro zoom


        // posição horizontal desejada do marcador dentro da área do mapa (fração 0..1)
        // 0.5 = centro; <0.5 desloca mais para a esquerda (útil para liberar espaço à direita)
        const positionFraction = 1; // ajuste entre 0.2 e 0.45 até ficar do jeito que prefere

        // projeta o ponto no mesmo zoom que vamos usar
        const latlng = L.latLng(station.lat, station.lon);
        const point = map.project(latlng, targetZoom);

        const latlng1 = L.latLng(station.lat, station.lon +3);
        const point1 = map.project(latlng1, targetZoom);

        const diffX = point1.x - point.x;


        const newPoint = point.add([diffX, 0]);

        const newCenter = map.unproject(newPoint, targetZoom);

        // muda a vista para o novo centro + zoom
        map.setView(newCenter, targetZoom, { animate: true });
    }, 350); // deve corresponder ao tempo da sua animação CSS (0.3s -> 300ms). Aumente se necessário.
  }


    function closeChart() {
      chartPanel.classList.remove('open');
      chartFrame.src = '';
      activeStation = null;

      // Espera o painel fechar para reajustar o mapa
      setTimeout(() => {
        map.invalidateSize();
        map.setView([-20, -44], 4, { animate: true });
      }, 350);
    }

    closeBtn.addEventListener('click', closeChart);

    // Carrega estações
    fetch('infos.json')
      .then(response => response.json())
      .then(stations => {
        stations.forEach(st => {
          const marker = L.marker([st.lat, st.lon], { icon: pinIcon }).addTo(map);
          marker.bindTooltip(st.name, { permanent: false, direction: 'top' });
          marker.on('click', () => openChart(st));
        });
      })
      .catch(err => console.error('Erro ao carregar infos.json:', err));
      
  </script>

<script>
  // ---------- Painel informativo superior direito ----------
  const infoControl = L.Control.extend({
    options: { position: 'topright' },
    onAdd: function (map) {
      const container = L.DomUtil.create('div', 'info-panel');
      container.style.background = 'rgba(255, 255, 255, 0.85)';
      container.style.padding = '12px 16px';
      container.style.borderRadius = '10px';
      container.style.boxShadow = '0 2px 10px rgba(0,0,0,0.2)';
      container.style.maxWidth = '250px';
      container.style.transition = 'opacity 0.3s ease';
      container.style.fontFamily = 'system-ui, sans-serif';
      container.style.color = '#333';
      container.style.position = 'relative';
      
      L.DomEvent.disableClickPropagation(container);
      
      container.innerHTML = `
        <h3 style="margin:0 0 8px 0;">CTW Tracker</h3>
        <div id="info-text" style="transition: opacity 0.3s ease;">
          <p style="margin:0 0 8px 0; font-size:0.85rem;">
            Aplicação para monitoramento em tempo real das ondas confinadas costeiras na margem continental brasileira utilizando os dados do <a href="https://www.simcosta.furg.br/home" target="_blank">SIMCosta</a>.
          </p>
          <p style="margin:0 0 12px 0; font-size:0.85rem;">
          </p>
        </div>
        <button id="lang-btn" style="
          padding: 4px 8px;
          border:none;
          border-radius:6px;
          background:#007bff;
          color:white;
          cursor:pointer;
          font-size:0.85rem;
          margin-bottom:4px;
        ">EN / PT</button>
        <button id="close-info-btn" style="
          position:absolute;
          top:4px;
          right:8px;
          background:transparent;
          border:none;
          font-size:18px;
          cursor:pointer;
          color:#333;
        " title="Fechar">×</button>
      `;
      return container;
    }
  });

  const info = new infoControl();
  map.addControl(info);

  document.addEventListener('DOMContentLoaded', () => {
    const container = document.querySelector('.info-panel');
    const closeBtn = document.getElementById('close-info-btn');
    const langBtn = document.getElementById('lang-btn');
    const infoText = document.getElementById('info-text');

    // Toggle painel visível
    closeBtn.addEventListener('click', () => {
      container.style.opacity = '0';
      setTimeout(() => container.style.display = 'none', 300);
    });

    // Toggle idioma EN/PT
    let isEnglish = false;
    langBtn.addEventListener('click', () => {
      infoText.style.opacity = '0';
      setTimeout(() => {
        if (!isEnglish) {
          infoText.innerHTML = `
            <p style="margin:0 0 8px 0; font-size:0.85rem;">
              Real-time monitoring of coastal trapped waves at the brazilian continental margin using <a href="https://www.simcosta.furg.br/home" target="_blank">SIMCosta</a> data.
            </p>
            <p style="margin:0 0 12px 0; font-size:0.85rem;">
              
            </p>
          `;
          langBtn.textContent = 'PT / EN';
        } else {
          infoText.innerHTML = `
            <p style="margin:0 0 8px 0; font-size:0.85rem;">
            Aplicação para monitoramento em tempo real das ondas confinadas costeiras na margem continental brasileira utilizando os dados do <a href="https://www.simcosta.furg.br/home" target="_blank">SIMCosta</a>.
            </p>
            <p style="margin:0 0 12px 0; font-size:0.85rem;">
            </p>
          `;
          langBtn.textContent = 'EN / PT';
        }
        isEnglish = !isEnglish;
        infoText.style.opacity = '1';
      }, 250); // duração da animação
    });
  });


</script>


</body>
</html>
